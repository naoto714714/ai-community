# Frontend固有のルール

1. **フレームワーク・ライブラリ**
   - パッケージ管理: npm（frontendディレクトリ内）
   - インストール: `npm install package`
   - 起動: `npm run dev`

2. **コンポーネント設計**
   - 関数コンポーネント + TypeScript
   - props型定義は必須
   - Mantineコンポーネントを優先使用

3. **状態管理**
   - 初期段階はReact useState
   - 将来的にContext API追加予定

4. **スタイリング**
   - Mantineテーマシステム使用
   - グローバルCSS最小限
   - CSS-in-JSアプローチ

5. **バックエンド連携**
   - Supabase PostgreSQL対応
   - WebSocket通信でリアルタイム同期
   - AI機能（Google Gemini）連携

6. **AI機能フロントエンド実装**
   - **AI応答表示**: AI人格名とアイコンによる視覚的識別
   - **メッセージ分類**: user_typeフィールド（"human" / "ai"）による適切な表示切り替え
     - 例: `if (message.user_type === "ai") { /* AI専用アイコン・スタイル */ }`
   - **@AIメンション**: ユーザーが`@AI`を含むメッセージで応答トリガー
   - **自律会話機能**: 自動的に受信するAI応答の自然な表示
     - 設定可能な間隔（`AI_CONVERSATION_INTERVAL_SECONDS`環境変数、デフォルト60秒、1秒〜24時間）で自動発言
     - 特別なマークや表示は付けない（自然な会話として表示）
     - WebSocket経由でリアルタイム受信・表示
   - **AI人格管理**: 5つのAI人格（レン、ミナ、テツ、ルナ、ソラ）の一貫した表示
   - **エラーハンドリング**: AI応答生成失敗時のフォールバック表示

7. **WebSocket通信のベストプラクティス**
   - **接続管理**: 自動再接続ロジックの実装
   - **オプティミスティックアップデート**: メッセージ送信時の即座UI更新
   - **エラー処理**: 送信失敗時のロールバック機能
   - **AI応答ブロードキャスト**: 全クライアントへの一括配信の受信処理

8. **UX/UI設計原則**
   - **レスポンシブデザイン**: モバイル・タブレット・PC対応
   - **ダークモード対応**: Mantineテーマシステム活用
   - **アクセシビリティ**: 適切なARIAラベルとキーボード操作対応
   - **パフォーマンス**: 仮想化やメモ化による最適化

9. **テスト要件**
   - **フレームワーク**: Vitest + Testing Library
   - **コンポーネントテスト**: 主要コンポーネントの動作確認
   - **統合テスト**: WebSocket通信とAI応答のエンドツーエンドテスト
   - **モック**: AI機能とWebSocket通信のモック使用

10. **開発コマンド**
    - 開発サーバー: `npm run dev`
    - ビルド: `npm run build`
    - テスト: `npm run test:run`
    - リント: `npm run lint`
    - 型チェック: `npm run type-check`
