# AI Community E2Eテスト仕様書

## 概要

本ドキュメントは、AI Communityチャットアプリケーションの包括的なEnd-to-End（E2E）テスト項目を定義します。
PlaywrightのMCPツールを使用して、ユーザー視点でのシステム全体の動作を検証します。

## テスト環境

- **フロントエンド**: http://localhost:5173
- **バックエンド**: http://localhost:8000
- **対象ブラウザ**: Chrome, Firefox, Safari
- **画面解像度**: 1920x1080（PC版優先）

## 1. 初期表示・基本レイアウト

### 1.1 アプリケーション起動
- [ ] ブラウザでアプリケーションにアクセスできる
- [ ] 初期ローディングが3秒以内に完了する
- [ ] エラーコンソールにエラーが表示されない

### 1.2 レイアウト構成
- [ ] 左サイドバー（280px幅）が表示される
- [ ] メインチャットエリアが表示される
- [ ] ヘッダーに「AI Community」のタイトルが表示される
- [ ] ダークモードがデフォルトで適用されている

### 1.3 レスポンシブデザイン
- [ ] 最小幅1024pxで正常に表示される
- [ ] ウィンドウリサイズ時にレイアウトが崩れない
- [ ] 横スクロールバーが表示されない

## 2. チャンネル機能

### 2.1 チャンネル一覧
- [ ] 初期表示で5つのチャンネルが表示される（雑談、ゲーム、音楽、趣味、ニュース）
- [ ] 各チャンネル名の先頭に「#」が表示される
- [ ] デフォルトで「雑談」チャンネルがアクティブになっている
- [ ] アクティブチャンネルが視覚的に識別できる（背景色の変更）

### 2.2 チャンネル切り替え
- [ ] チャンネルをクリックすると選択される
- [ ] チャンネル切り替え時にメッセージリストが更新される
- [ ] チャンネル切り替え時に過去のメッセージが読み込まれる
- [ ] チャンネル切り替え中にローディング表示がされる
- [ ] 異なるチャンネルのメッセージが混在しない

## 3. メッセージ送受信

### 3.1 メッセージ入力
- [ ] メッセージ入力欄が表示される
- [ ] プレースホルダー「メッセージを入力...」が表示される
- [ ] テキストを入力できる
- [ ] 改行（Shift+Enter）でテキストエリアが拡張される
- [ ] 最大文字数（1000文字）を超えると入力できない

### 3.2 メッセージ送信
- [ ] Enterキーでメッセージが送信される
- [ ] 送信ボタンクリックでメッセージが送信される
- [ ] 空メッセージは送信されない
- [ ] 送信後、入力欄がクリアされる
- [ ] 送信したメッセージが即座に画面に表示される（楽観的更新）

### 3.3 メッセージ表示
- [ ] 自分のメッセージが右側に青色で表示される
- [ ] 他人のメッセージが左側にグレー色で表示される
- [ ] メッセージに送信者名が表示される
- [ ] タイムスタンプが正しい形式（HH:mm）で表示される
- [ ] 長いメッセージが適切に折り返される
- [ ] 絵文字が正しく表示される

### 3.4 自動スクロール
- [ ] 新規メッセージ受信時に自動的に最下部へスクロールする
- [ ] ユーザーが上にスクロールしている場合は自動スクロールしない
- [ ] 自分がメッセージを送信した場合は常に最下部へスクロールする

## 4. WebSocket通信

### 4.1 接続管理
- [ ] ページロード時にWebSocket接続が確立される
- [ ] 接続状態がコンソールで確認できる
- [ ] ページリロード時に再接続される
- [ ] タブを閉じた時に接続が切断される

### 4.2 リアルタイム同期
- [ ] 複数ブラウザ/タブで同じメッセージがリアルタイムに表示される
- [ ] メッセージの順序が全クライアントで一致する
- [ ] 遅延が1秒以内である

### 4.3 エラーハンドリング
- [ ] バックエンドが停止している場合、エラーメッセージが表示される
- [ ] WebSocket接続エラー時に再接続を試みる
- [ ] ネットワークエラー時に適切なエラーメッセージが表示される

## 5. データ永続性

### 5.1 メッセージ履歴
- [ ] ページリロード後も過去のメッセージが表示される
- [ ] チャンネルを切り替えて戻っても履歴が保持される
- [ ] 異なるブラウザからアクセスしても同じ履歴が表示される

### 5.2 データ整合性
- [ ] 送信したメッセージがデータベースに保存される
- [ ] メッセージIDの重複がない
- [ ] タイムスタンプが正確に記録される

## 6. パフォーマンス・UX

### 6.1 レスポンス速度
- [ ] メッセージ送信のレスポンスが200ms以内
- [ ] チャンネル切り替えが500ms以内に完了
- [ ] 100件のメッセージ表示でも画面がフリーズしない

### 6.2 アニメーション
- [ ] メッセージ表示時のフェードインアニメーションが滑らか
- [ ] スクロールが滑らかに動作する
- [ ] ホバー効果が適切に動作する

### 6.3 フィードバック
- [ ] 送信中の状態が視覚的にわかる
- [ ] エラー時に明確なエラーメッセージが表示される
- [ ] 成功時の視覚的フィードバックがある

## 7. エッジケース・異常系

### 7.1 大量データ
- [ ] 1000件以上のメッセージでも正常に動作する
- [ ] 非常に長いメッセージ（1000文字）が正しく表示される
- [ ] 連続して高速にメッセージを送信してもエラーにならない

### 7.2 特殊文字・入力
- [ ] HTML特殊文字（<, >, &）が正しくエスケープされる
- [ ] Unicode絵文字が正しく表示される
- [ ] 改行を含むメッセージが正しく表示される
- [ ] スペースのみのメッセージは送信されない

### 7.3 同時アクセス
- [ ] 10人が同時にメッセージを送信してもエラーにならない
- [ ] 同じユーザーが複数タブから送信しても正常に動作する
- [ ] チャンネル切り替えとメッセージ受信が同時に発生してもエラーにならない

## 8. セキュリティ関連

### 8.1 XSS対策
- [ ] `<script>alert('XSS')</script>` のような入力が実行されない
- [ ] JavaScriptコードを含むメッセージが実行されない
- [ ] HTMLタグがそのまま文字として表示される

### 8.2 CORS設定
- [ ] 許可されていないオリジンからのアクセスが拒否される
- [ ] フロントエンドからのAPIアクセスが正常に動作する

## 9. アクセシビリティ

### 9.1 キーボード操作
- [ ] Tabキーでフォーカスが適切に移動する
- [ ] Enterキーでメッセージ送信ができる
- [ ] Escapeキーで入力をキャンセルできる（実装されている場合）

### 9.2 スクリーンリーダー対応
- [ ] 適切なARIAラベルが設定されている
- [ ] 見出し構造が適切である
- [ ] フォーカス状態が視覚的に識別できる

## 10. ブラウザ互換性

### 10.1 対応ブラウザ
- [ ] Chrome最新版で正常動作
- [ ] Firefox最新版で正常動作
- [ ] Safari最新版で正常動作
- [ ] Edge最新版で正常動作

### 10.2 ブラウザ固有機能
- [ ] 各ブラウザでWebSocketが正常に動作する
- [ ] 各ブラウザでCSSが正しく適用される
- [ ] 各ブラウザでJavaScriptエラーが発生しない

## テスト実行手順

1. バックエンドサーバーを起動
   ```bash
   cd src/backend
   uv run uvicorn main:app --reload
   ```

2. フロントエンドサーバーを起動
   ```bash
   cd src/frontend
   npm run dev
   ```

3. Playwrightテストを実行
   ```bash
   # 詳細なテストスクリプトは別途作成予定
   ```

## 優先度

### 高優先度（必須）
- 基本的なメッセージ送受信
- チャンネル切り替え
- WebSocket通信
- データ永続性

### 中優先度（重要）
- エラーハンドリング
- パフォーマンス
- 複数ユーザー対応

### 低優先度（推奨）
- アクセシビリティ
- ブラウザ互換性の詳細
- エッジケースの一部

## 備考

- 現在認証機能は未実装のため、ユーザー認証に関するテストは含まれていません
- モバイル対応は現在のスコープ外です
- ファイルアップロード機能は未実装のため、テスト項目に含まれていません

このテスト仕様書は、プロジェクトの進展に応じて更新される必要があります。